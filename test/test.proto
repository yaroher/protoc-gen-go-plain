syntax = "proto3";

option go_package = "github.com/yaroher/protoc-gen-go-plain/test";

package test;

import "google/protobuf/timestamp.proto";
import "goplain/goplain.proto";

option (goplain.file).go_types_overrides = {
  selector: { field_kind: TYPE_STRING }
  target_go_type: { name: "UUID", import_path: "github.com/google/uuid" }
};

message TestMessage {
  option (goplain.message).generate = true;
  option (goplain.message).virtual_fields = {
    name: "password_hash"
    kind: TYPE_BYTES
  };
  option (goplain.message).virtual_fields = {
    name: "created_at_unix"
    kind: TYPE_INT64
  };
  option (goplain.message).virtual_fields = {
    name: "virt_addr"
    kind: TYPE_MESSAGE
    type_url: ".test.TestMessage.Address"
  };
  option (goplain.message).virtual_fields = {
    name: "virt_enum"
    kind: TYPE_ENUM
    type_url: ".test.TestMessage.ContactType"
  };

  message UserId {
    option (goplain.message).type_alias = true;
    string value = 1;
  }

  message Email {
    option (goplain.message).type_alias = true;
    string value = 1;
  }

  message Address {
    string street = 1;
    string city = 2;
    string country = 3;
  }

  message AuditInfo {
    google.protobuf.Timestamp created_at = 1;
    google.protobuf.Timestamp updated_at = 2;
  }

  message Settings {
    string theme = 1;
    bool notifications = 2;
  }

  message ContactEmail {
    string email = 1;
  }

  message ContactPhone {
    string phone = 1;
  }

  message PaymentCard {
    string card_number = 1;
  }

  message PaymentCrypto {
    string wallet = 1;
  }

  enum ContactType {
    CONTACT_TYPE_UNSPECIFIED = 0;
    CONTACT_TYPE_EMAIL = 1;
    CONTACT_TYPE_PHONE = 2;
  }

  string name = 1;
  UserId id = 2;
  Email email = 3;

  Address address = 4 [(goplain.field).embed = true];
  Address work_address = 5 [(goplain.field).embed_with_prefix = true];
  AuditInfo audit = 6 [(goplain.field).embed = true];

  Settings settings = 7 [(goplain.field).serialize = true];

  string raw_id = 8 [(goplain.field).override_type = {name: "UUID", import_path: "github.com/google/uuid"}];
  google.protobuf.Timestamp created_at_ts = 9 [(goplain.field).override_type = {name: "Time", import_path: "time"}];

  oneof contact {
    option (goplain.oneof).embed = true;
    ContactEmail email_contact = 10;
    ContactPhone phone_contact = 11;
  }

  oneof backup_contact {
    option (goplain.oneof).embed_with_prefix = true;
    ContactEmail backup_email = 12;
    ContactPhone backup_phone = 13;
  }

  oneof payment_method {
    option (goplain.oneof).enum_dispatched = true;
    PaymentCard card = 14;
    PaymentCrypto crypto = 15;
  }

  oneof backup_payment_method {
    option (goplain.oneof).enum_dispatched_with_prefix = true;
    PaymentCard backup_card = 16;
    PaymentCrypto backup_crypto = 17;
  }

  ContactType contact_type = 18;

  oneof contact_enum_dispatch {
    option (goplain.oneof).with_enum = "test.TestMessage.ContactType";
    ContactEmail enum_email = 19 [(goplain.field).oneof_enum_value = "CONTACT_TYPE_EMAIL"];
    ContactPhone enum_phone = 20 [(goplain.field).oneof_enum_value = "CONTACT_TYPE_PHONE"];
  }
}
